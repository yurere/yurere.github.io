function rating_form_is_json(t){try{return JSON.parse(t)&&!!t}catch(t){return!1}}function rating_form_apply_data(t){var r=t.checks,e=t.parent,a=e.find(".rating_form"),n=e.find(".rf_item").not(".spinner"),s=n.length,o=(n.not(".hover").length,!!a.parent().hasClass("rf_rtl")),l=o?n.find("img").length>0?"-half":"-rtl-half":"-half",f=0==s?"":n.attr("class").split(" ")[1];f=-1==f.indexOf(l)?f:f.replace(l,"");var d=a.find(".rf_side,.def").length,c=n.filter("."+f+l).index(),_=-1==(c=c>-1?o?c<=2?d-c:c-d:c:-1)?"":a.find('[class*="'+l+'"]').attr("class").split(" ")[1];_="rf_item "+_;var p="-empty",g=!!a.hasClass("empty_on"),m=r.hasOwnProperty("average")?r.average:"",h=r.hasOwnProperty("count")?r.count:"",u=r.hasOwnProperty("count_percent")?r.count_percent:"",v=r.hasOwnProperty("up_count")?r.up_count:"",y=r.hasOwnProperty("down_count")?r.down_count:"",w=r.hasOwnProperty("thankyou")?r.thankyou:"",x=r.hasOwnProperty("thankyou")?r.edit_rating:"",C=r.hasOwnProperty("icon_count")?r.icon_count:"",j=r.hasOwnProperty("icon_half")?r.icon_half:"";j-=1;var k=r.hasOwnProperty("scripts")?r.scripts:"";""!=k&&e.append(k),0==e.find(".rating_form .thankyou").length&&e.find(".rating_form .rf_side").append(w),e.find(".edit_rating_text").text(x);var Q=e.find(".rating_form .rf_average");Q.length&&Q.text(m);var O=e.find(".rating_form .rf_count");O.length&&O.text(h);var P=e.find(".rating_form .rf_count_percent");if(P.length){var b=P.text().replace(/\d+[.]?\d*/g,u);P.text(b)}var A=e.find(".rating_form .up_rated_txt");if(A.length){var q=A.text().replace(/\d+/g,v);A.text(q)}var T=e.find(".rating_form .down_rated_txt");if(T.length){var I=T.text().replace(/\d+/g,y);T.text(I)}if(C=o?s-C:C,C+=(j=o?s-j-1:j)>-1?1:0,j!=c)if(j>-1){var S="rf_item "+f+l+" hover";e.find(".rating_form .rf_item").eq(j).attr("class",S)}else{e.find(".rating_form .rf_item").eq(c).attr("class");e.find(".rating_form .rf_item").eq(c).attr("class",_.replace(l,""))}for(e.find(".rating_form .rf_item").removeClass("hover"),i=0;i<C;i++){var D=e.find(".rating_form .rf_item").eq(i);g&&D.attr("class",D.attr("class").replace(p,"")),D.addClass("hover")}var H="rf_item "+f+p;for(i=C;i<s;i++){D=e.find(".rating_form .rf_item").eq(i);g&&(D.is('[class*="-empty"]')||D.attr("class",H))}c=j}jQuery(document).ready(function(){var t=!1;jQuery(".rating_form_wrap").each(function(){var r,e,a,n,i,s,o,l,f,d,c,_,p=jQuery(this),g=".rf_item",m=p.data("rf-id"),h=!1,u=!1,v=!1,y=!1,w=0,x=0,C=null,j="top",k="center",Q="bottom",O="center",P=p.find(".rating_form");!P.is(".rating_form_result")&&P.attr("data-state")&&(u||(u=!0),(w=parseInt(jQuery(this).find('input[name="rf_rating"]').val())||0)>0&&(f?jQuery(this).find(g).slice(l-w,l).addClass("hover"):jQuery(this).find(g).slice(0,w).addClass("hover"))),p.on("mouseenter",g+", .rf_ttip",function(){var t=jQuery(this),_=t.parents(".rating_form_wrap"),m=t.parent();if(m.is(".rf_mobile"))t.click();else if(u&&t.on("click",function(){var r=t.data("rating").replace("r","");m.find('input[name="rf_rating"]').val(r),console.log("rateClicked: "+w),w===r?(y=!0,v=!1,console.log("Same rating clicked: "+r)):(w=r,console.log("Clicked Rating: "+w),_.bind("mouseleave"),v=!0)}),!m.is(".rating_form_result")){var x=p.find(".rf_settings[data-rf-tip-position]").data("rf-tip-position");null!=x&&(x=x.split("-"),j=x[0],k=x[1]);var C=p.find(".rf_settings[data-rf-tip-arrow-position]").data("rf-tip-arrow-position");null!=C&&(C=C.split("-"),Q=C[0],O=C[1]),a=t.parent(),r=a.find(g).not(".spinner"),l=r.length,o=l-r.not(".hover").length,f=!!a.parent().hasClass("rf_rtl"),d=f?t.find("img").length>0?"-half":"-rtl-half":"-half",i=-1==(i=-1==l?"":r.attr("class").split(" ")[1]).indexOf(d)?i:i.replace(d,"");var P=a.find(".rf_side,.def").length;if(n=r.filter("."+i+d).index(),s="rf_item "+(s=-1==(n=n>-1?f?n<=2?P-n:n-P:n:-1)?"":a.find('[class*="'+d+'"]').attr("class").split(" ")[1]),h=!!a.hasClass("empty_on"),r.removeClass("hover"),t.not(".spinner").attr("title")){e=t.attr("title");var b=" rf_arrow_top",A=" rf_arrow_center";"bottom"==Q&&(b=" rf_arrow_bottom"),"left"==O&&(A=" rf_arrow_left"),"right"==O&&(A=" rf_arrow_right"),t.append('<div class="rf_tooltip">'+e+'<div class="rf_arrow'+b+A+'"></div></div>'),c="0"==t.css("padding-right").replace(/\D/g,"")?t.width()/2+t.outerWidth()-t.width():"0"==t.css("padding-left").replace(/\D/g,"")?t.width()/2:t.outerWidth()/2;var q=t.find(".rf_tooltip"),T=q.outerWidth(),I=q.outerHeight(),S=(q.css("top").replace(/\D/g,""),q.find(".rf_arrow").outerHeight()),D=q.find(".rf_arrow").css("margin-top").replace(/\D/g,""),H=q.find(".rf_arrow").css("margin-bottom").replace(/\D/g,"");S=parseInt(S)+parseInt(D)+parseInt(H);var R=t.outerWidth(),W=t.outerHeight(),J=t.position().top,L=t.position().left,N=J-I-S,Y=L-T/2+c;if("bottom"==j&&(N=J+W+S),"left"==k?Y=L:"right"==k&&(Y=L-T+R),"center"==O&&"center"!=k){var z=R/T*100;"left"==k&&(z/=2),"right"==k&&(z=100-z/2),q.find(".rf_arrow_center").css("left",z+"%")}q.css({top:N+"px",left:Y+"px"}),t.attr("title","")}if(t.find("img").length>0){var B=t.find("img").attr("src"),E=B.substring(0,B.lastIndexOf("/")+1);t.find("img").attr("src",E+"custom-full.png"),f?t.prevAll().find("img").attr("src",E+"custom-empty.png"):t.nextAll().find("img").attr("src",E+"custom-empty.png"),l>3&&(f?t.nextAll().find("img").attr("src",E+"custom-full.png"):t.prevAll().find("img").attr("src",E+"custom-full.png"))}n>-1&&r.eq(n).attr("class",s.replace(d,"")),h&&(t.attr("class",t.attr("class").replace("-empty","")),f?(t.nextAll().filter(g).attr("class",t.attr("class").replace("-empty","")),t.prevAll().filter(g).attr("class",t.attr("class")+"-empty")):(t.prevAll().filter(g).attr("class",r.attr("class").replace("-empty","")),t.nextAll().filter(g).attr("class",r.attr("class")+"-empty"))),t.addClass("hover"),l>3&&(f?t.nextAll().filter(g).addClass("hover"):t.prevAll().filter(g).addClass("hover"))}}),p.on("mouseleave",g+", .rf_ttip",function(){var t=jQuery(this);t.parents(".rating_form_wrap");if(!t.parent().is(".rating_form_result")){if(a=t.parent(),(r=a.find(g).not(".spinner")).removeClass("hover"),t.find("img").length>0){var i=t.find("img").attr("src"),d=i.substring(0,i.lastIndexOf("/")+1);r.find("img").attr("src",d+"custom-empty.png"),f?r.slice(l-o,l).find("img").attr("src",d+"custom-full.png"):r.slice(0,o).find("img").attr("src",d+"custom-full.png"),n>-1&&r.eq(n).find("img").attr("src",d+"custom-half.png")}h&&(r.attr("class",r.attr("class").replace("-empty","")),f?u?(r.slice(l-w,l).attr("class",r.attr("class").replace("-empty","")),r.slice(0,l-w).attr("class",r.attr("class")+"-empty")):(r.slice(l-o,l).attr("class",r.attr("class").replace("-empty","")),r.slice(0,l-o).attr("class",r.attr("class")+"-empty")):(r.slice(0,o).attr("class",r.attr("class").replace("-empty","")),u?r.slice(w,l).attr("class",r.attr("class")+"-empty"):r.slice(o,l).attr("class",r.attr("class")+"-empty"))),n>-1&&!u&&r.eq(n).attr("class",s),f?u?r.slice(l-w,l).addClass("hover"):r.slice(l-o,l).addClass("hover"):u?r.slice(0,w).addClass("hover"):r.slice(0,o).addClass("hover"),null!=e&&(t.attr("title",e),a.find(".rf_tooltip").remove()),u&&(y?(r.removeClass("hover"),a.find('input[name="rf_rating"]').val(""),w="",y=!1,console.log("isCommentReview",u),console.log("rateClicked",w),console.log("reviewSameRatingClick",y),console.log("reviewRatingClick",v)):(f?t.nextAll().filter(g).addClass("hover"):t.prevAll().filter(g).addClass("hover"),t.addClass("hover")))}}),p.on("click",g,function(){var r=jQuery(this).parents(".rating_form_wrap"),e=jQuery(this).parent(),a=r.find(".rating_stats");if(window.clearTimeout(_),r.find(".rating_form .rated").length>0)return r.find('[class*="edit_rating"]').hide(),e.find(".def").not(".up_rated_txt,.down_rated_txt").hide(),e.find(".rated").show(),void(_=setTimeout(function(){e.find(".def").not(".rated,.up_rated_txt,.down_rated_txt").show(),r.find('[class*="edit_rating"]').show(),e.find(".rated").hide()},3e3));if(!t&&!e.attr("data-state")&&(t=!0,0===r.find(".rating_form_result").length)){var n=jQuery('.rating_form_wrap[data-id="'+m+'"]'),i=jQuery(this).data("rating"),s=0!==jQuery(this).find(".title").length,o=0!==e.find(".rating_score").length,l=0!==e.find(".rating_total").length,f=0!==r.find(".stats_on").length,d=0!==r.find(".user_stats_on").length,c=!1===l?"":e.find(".rating_total").text().replace(/[-+]?\d+/g,""),g=!1===o?"":e.find(".rating_score").text().replace(/(\d*[.])?\d+/g,"%s");jQuery(this).parent().find(".rf_tooltip").remove();var h=void 0!==jQuery(this).attr("title"),u=0!==r.find("[itemtype]").length,v=p.find(".rf_settings[data-rf-cig]").data("rf-cig"),y=r.find(".rating_form").data("edit-id"),w=0===r.find(".rating_before_content").length?"":r.find(".rating_before_content").html(),j=0===r.find(".rating_after_content").length?"":r.find(".rating_after_content").html(),k=!!r.find(".redirect_on").length,Q=r.find(".rating_form").data("redirect-url"),O=r.find(".rating_form").data("redirect-params");O=void 0===O?"":O.replace(/%user_rating%/,i);var P=r.find(".rating_form").data("redirect-target"),b=k?window.open(Q+O,P):"";r.find('[class*="edit_rating"]').hide();var A=r.find("[class*=spinner]").length?r.find("[class*=spinner]").attr("class").match(/spinner(\d+)_on/):null;e.hasClass("spinner_on")?(e.append('<span class="rf_item spinner cyto-spinner cyto-spin"></span>'),e.find(".rf_item:not(.spinner), .def").hide(),a.addClass("update")):null===A?(e.addClass("update"),a.addClass("update")):(e.append('<span class="rf_item spinner cyto-spinner'+A[1]+' cyto-spin"></span>'),e.find(".rf_item:not(.spinner), .def").hide(),a.addClass("update")),jQuery(this).attr("data-rating")&&jQuery.ajax({type:"POST",url:rating_form_script.ajaxurl,data:{action:"rating_form_rating_add",form_id:m,rated:i,title:s,score:o,total:l,stats:f,user_stats:d,tooltip:h,rich_snippet:u,custom_id_group:v,rates:c,txt_score:g,edit_rating:y,before_content:w,after_content:j},success:function(a){var i=!!rating_form_is_json(a)&&JSON.parse(a),s="";(i.hasOwnProperty("rated")?s=i.rated:i.hasOwnProperty("login")?s=i.login:i.hasOwnProperty("limit")&&(s=i.limit),!1!==i&&""==s)?(rating_form_apply_data({checks:i,parent:r}),k&&b.location,e.find(".rf_item,.up_rated_txt,.down_rated_txt").show(),n.not(r).html(a).find(".rating_form .thankyou").remove(),r.find(".rating_form .thankyou").length>0&&(r.find(".rating_form .rating_total, .rating_form .rating_score").not(".thankyou").hide(),_=setTimeout(function(){jQuery.when(r.find(".rating_form .thankyou").remove()).then(function(){r.find('[class*="edit_rating"]').show(),r.find(".rating_form .rating_total, .rating_form .rating_score").not(".thankyou, .rated").show()})},3e3))):!1!==i&&""!=s&&0==r.find(".rating_form .rated").length&&(e.find(".thankyou").length>0&&e.find(".thankyou").remove(),e.find(".rf_item,.up_rated_txt,.down_rated_txt").show(),e.find(".rf_side").append(s),e.find(".rated").show(),x=i.hasOwnProperty("time_left")?i.time_left:0,null==C&&0!=x&&(C=setTimeout(function(){jQuery.when(r.find(".rating_form .rated").remove()).then(function(){console.log("Limit time's up. You can vote again!"),C=null,x=0})},1e3*x+2e3),console.log("limitTimeLeft: ",x)),_=setTimeout(function(){jQuery.when(r.find(".rating_form .rated").hide()).then(function(){r.find(".rating_form .def").not(".rated").show(),r.find('[class*="edit_rating"]').show()})},3e3));e.find(".spinner").length>0&&e.find(".spinner").remove(),e.hasClass("update")&&e.removeClass("update"),r.find(".rating_stats").length>0&&r.find(".rating_stats").remove(),t=!1},error:function(t){console.log(t)}})}}),p.on("click",".edit_rating",function(){var t=jQuery(this).parents(".rating_form_wrap"),r=t.find(".rating_form"),e=jQuery(this);0===t.find(".rating_form_result").length?(r.removeClass("cursor"),r.addClass("rating_form_result"),e.css("opacity","1")):t.find(".rating_form_result").length>0&&(r.removeClass("rating_form_result"),r.addClass("cursor"),e.css("opacity","0.4"))}),p.on("click",".rating_total",function(){var t=jQuery(this),r=jQuery(this).parents(".rating_form_wrap"),e=r.find(".rating_form"),a=r.find(".rating_stats"),n=!!r.hasClass("rf_rtl"),i=0!==r.find(".stats_on").length,s=0!==r.find(".user_stats_on").length,o=r.find(".rating_total").text(),l=r.find(".rating_total .rf_count, .rating_total .rf_count_percent").text(),f=e.attr("data-state")?e.data("state"):"";if(0!=l.replace("%",""))if(a.length>0)a.css({top:e.position().top-a.outerHeight()-10,left:n?e.position().right:e.position().left}),e.toggleClass("rating_stats_active"),a.is(":visible")?a.fadeOut():a.length>0&&a.fadeIn();else{var d={action:"show_rf_stats",form_id:m,stats:i,user_stats:s,rates:o,count:l,state:f};jQuery.ajax({type:"POST",url:rating_form_script.ajaxurl,data:d,beforeSend:function(){t.css("opacity","0.4")},success:function(a){r.append(a);var i=r.find(".rating_stats");i.css({top:e.position().top-i.outerHeight()-10,left:n?e.position().right:e.position().left}),i.show(),i.on("click",".rf_stats_close",function(){i.hide(),e.removeClass("rating_stats_active")}),t.css("opacity","1")},error:function(t){console.error(t,d)}})}})})});